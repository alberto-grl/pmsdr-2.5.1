=head1 NAME

pmsdr, pmsdr_dyn -  Linux PMSDR 2.0/2.1 control program

=head1 SYNOPSIS

pmsdr [-h] [-u port] [-N device number] [-B USB bus] [-l]

=head1 DESCRIPTION


This software manages an PMSDR receiver hardware version 2.0 and 2.1 on *nix operating systems.
As per the current state of the development (4Q 2010) the PMSDR doesn't have 
any A/D conversion capability, therefore the availability of an audio card with duplex 
capability is mandatory.

As default, pmsdr try to listen for commands on the FIFO /tmp/PMSDRcommands.
This is useful if pmsdr is used together with the especially crafted sdr-shell found in

http://code.google.com/p/sdr-shell/source/browse/#svn/branches/pmsdr

If the above FIFO doesn't exist, pmsdr fall back to interactive on standard input/output, anyway 
useful for test.

As provided pmsdr is not able to connect to hardware, unless you start owning superuser privileges.
Please carefully read the README file to learn how setup udev subsystem to avoid that.
Similar considerations apply for the firmware upgrades.




=head1 OPTIONS

B<-h> display a short help text

B<-l> list all USB devices, PMSDR are shown with asterisk aside.

B<-u> listen for commands on udp port specified. The argument is a short integer (1-65535).
Please remeber that using port < 1024 requires super users privilegs.

If run without options try to open the first PMSDR hardware found on USB interfaces.

B<-B> uses the first PMSDR found on nth USB bus

B<-N> uses the nth PMSDR device (the device number can be found using the -l option)


=head1 EXAMPLES

Try to link to the first device found:

          pmsdr

Link to the third device and listen for commands at the port 12345:

          pmsdr -N3 -u12345


=head1 EXIT STATUS

pmsdr returns  a  zero  exist  status  if it succeeds to open the hardware.
Non zero is returned in case of failure.


=head1 COMMANDS

B<f frequency>  
 
 set QSD receiver frequency (in Hertz); the value must be in (0.1-55MHz) range

B<filter n>
 set the receiver filter according to the following table:

=over 5

=item * 0 .... no filter

=item * 1 .... Band pass 2-6 MHz

=item * 2 .... Band pass 6-13 MHz

=item * 3 .... Band pass 12-30 MHz

=item * 4 .... Low pass 2 MHz

=back


B<f3 frequency>       
 set QSD third harmonic receiver frequency (in Hertz); the value must be in (0,3-165 MHz) range 

B<fd frequency>      
 set the downconverter LO frequency (in Hertz); the value must be in 10-810 MHz range

B<qsdbias bias>      
 set the QSD mixer bias level, 512 (default), 346-692 (interval allowed) 

B<qsdmute (on|off)>  
 mute the QSD receiver

B<memf frequency >   
 set the frequency in not volatile memory in receiver  

B<dfilter n>
 set the down converter filter according to the following table:

=over 5

=item * 0 .... down converter bypass

=item * 1 .... VHF filter

=item * 2 .... UHF filter

=item * 3 .... filter disabled

=back


B<memf frequency>
 store initial frequency into PMSDR EEPROM 

B<memf3  frequency>
 store initial third harmonic frequency into PMSDR EEPROM 

B<rmemf>
 restore frequency from PMSDR EEPROM

B<quit>              
 terminate the current process

B<plcd x-coord y-coord message_text>   
 print the message text at X,Y coord on the LCD 

B<ifgain gain>      
 for compatibility with old hardware, not anymore apply for current 2.1 hardware   


=head1 HOW TO COMPILE PMSDR

On the first time, it is better compile getting the sources from tarball.

Download the source tarball from Sourceforge:

 wget https://downloads.sourceforge.net/project/pmsdr/pmsdr-2.4.1.tar.gz

(Anyway check, on the SourceForge project page, that the above package is the more recent stable one)

Extract sources:

 cd
 tar -zxvf pmsdr-2.4.1.tar.gz

=begin html
  
Once you have the software sources, please refer to <a href="README">README</a> files for more detailed instructions.

=end html

For anyone interested to contribute, this software is available on SourceForge SVN repository at the following URL:

B<https://pmsdr.svn.sourceforge.net/svnroot/pmsdr>

You can do a checkout of whole repository with the following command:

B<svn co https://pmsdr.svn.sourceforge.net/svnroot/pmsdr pmsdr >

For stable release please look on main SourceForge page or in /tags directory.
I<Please keep in mind that /trunk might have in unpredictable results because it is
used for intermediate development release.>


=head1 PMSDR FIRMWARE UPGRADE


Install libusb 0.1.x and wget:

B<sudo apt-get install libusb-0.1-4 libusb-dev wget>

Download and compile the fsusb package:

 cd
 wget http://www.internetking.org/fsusb/fsusb-0.1.11-2.tar.gz
 tar -zxvf fsusb-0.1.11-2.tar.gz
 cd fsusb-0.1.11-2
 make

Download and unzip the firmware file from Martin' site:

 wget http://www.iw3aut.altervista.org/files/PMSDR_V21r7.zip
 unzip PMSDR_V21r7.zip

You must have the .hex file into the current directory: 

 ls -l *.hex
 -rw-r--r-- 1 andrew andrew 93031 2010-02-14 21:53 PMSDR_V21r7.hex

Double check the file length of file you get after unzip.
If it is not equal to that shown above, repeat the procedure !


Now unmount the cover of the PMSDR box and link your PMSDR to USB 
interface.  Please be careful when the box cover is removed: don't touch 
the internal components when the circuits is powered.  

Look behind the USB connector and locate the two push buttons S1 and S2: 
they are marked on the silkscreen too.

Wait until the display shows the usual messages and the green LED turn on, 
press both the buttons labeled S1 and S2; they are located into the lower left 
corner of PCB just behind the USB connector.  

The display will be erased: release the S1 button and, after one second, the S2 button.
When you release the S1 button the red LED will blink shortly.
When you release the S2 button the red LED will light steady.

Now the PMSDR is in bootloader mode with both green LED and red LED turned on.
Moreover the PMSDR has renumbered on the USB bus: the VID:PID is now changed as follows:

 $ lsusb
 Bus 003 Device 022: ID 04d8:000b Microchip Technology, Inc. 

Note that the PID must now read as 000b instead of 000c.

The next step requires you run the fsusb program.
B<Please do not detach the USB cable while the loader program is running !!!>

 $ sudo ./fsusb PMSDR_V21r7.hex
 Locating USB Microchip(tm) PICDEM-FS USB(tm) (vendor 0x04d8/product 0x000b)
 Found USB PICDEM-FS USB as device '022' on USB bus 003
 Communication established.  Onboard firmware version is 1.0
 Writing program memory successful
 Program memory validated

Please ignore the message says that firmware version is 1.0: it refers to 
the bootloader protocol and not to PMSDR firmware.  The programming lasts 
about 30 seconds: when the fsusb program ends you have to reset the PMSDR 
to recover the normal operation.  Press again the S1 button and the 
display will show 

 FW-VERSION 2.1.7

on the second row.



=head1 AUTHOR

Martin Pernter IW3AUT, Linux porting by Andrea Montefusco IW0HDV


=head1 SEE ALSO

The main PMSDR site from Martin IW3AUT:

B<http://www.iw3aut.altervista.org/>

Patrick Kulle, DH2SPK wrote an excellent HowTo's for get working PMSDR on Linux with DttSP and 
sdr-shell:

B<http://www.dh2spk.de/amateurfunk/sdr/>


